---
layout: post
title: Flutter ListView & GridView
summary:
categories: Flutter
technique: true
---

## | ListView

数据较少时，可以直接使用如下方式(一次加载所有的组件，没有“懒加载”)：

```dart
ListView(
  children: <Widget>[
    _ListItem(title: '1',),
    _ListItem(title: '2',),
    _ListItem(title: '3',),
    _ListItem(title: '4',),
    _ListItem(title: '5',),
    _ListItem(title: '6',),
  ],
)
// _ListItem 定义如下：
class _ListItem extends StatelessWidget {
  final String title;
  const _ListItem({Key key, this.title}) : super(key: key);
  @override
  Widget build(BuildContext context) {
    return Card(
      child: Container(
        height: 45,
        alignment: Alignment.center,
        child: Text('$title'),
      ),
    );
  }
}
```

当有大量数据时，使用动态创建列表的方式:

```dart
ListView.builder(
  itemBuilder: (BuildContext context, int index) {
    return _ListItem(
      title: '$index',
    );
  },
  itemExtent: 50, // 每一个Item的高度
  itemCount: 30, // 个数
  scrollDirection: Axis.horizontal, // 滚动方向，默认是垂直方向，可以设置为水平方向。
  reverse: false, //是否反转滚动方向，比如当前滚动方向是垂直方向，reverse : true，滚动方向为从上倒下，reverse:false，滚动方向为从下倒上。
)
```

ScrollController 是 ListView 组件的控制器，通过 ScrollController 可以获取当前滚动的位置，也可以滚动到指定的位置。用法如下：

```dart
class _ListViewDemoState extends State<ListViewDemo> {
  ScrollController _controller;

  @override
  void initState() {
    _controller = ScrollController()
      ..addListener(() {
        print('${_controller.position}');
      });
    super.initState();
  }

  @override
  Widget build(BuildContext context) {
    return ListView.builder(
      controller: _controller,
      reverse: false,
      itemBuilder: (BuildContext context, int index) {
        return _ListItem(
          title: '$index',
        );
      },
      itemCount: 30,
      itemExtent: 50,
    );
  }
}

// 指定跳转到指定位置：
@override
Widget build(BuildContext context) {
  return Column(
    children: <Widget>[
      Container(
        child: RaisedButton(
          child: Text('滚动到指定位置'),
          onPressed: () {
            _controller.animateTo(200,
                duration: Duration(milliseconds: 300), curve: Curves.linear);
          },
        ),
      ),
      Expanded(
        child: ListView.builder(
          controller: _controller,
          reverse: false,
          itemBuilder: (BuildContext context, int index) {
            return _ListItem(
              title: '$index',
            );
          },
          itemCount: 30,
          itemExtent: 50,
        ),
      )
    ],
  );
}
```

physics 参数表示当滚动到顶部或者底部时滚动的物理特性。比如设置为不可滚动：

> 系统提供的 ScrollPhysics 有：
>
> - AlwaysScrollableScrollPhysics：总是可以滑动
> - NeverScrollableScrollPhysics：禁止滚动
> - BouncingScrollPhysics ：内容超过一屏 上拉有回弹效果
> - ClampingScrollPhysics ：包裹内容 不会有回弹

```javascript
ListView(
    physics: NeverScrollableScrollPhysics(),
  ···
)
```

在每一项中间增加分割线可以使用如下方式：

```dart
ListView.separated(
  itemBuilder: (BuildContext context, int index) {
    return Container(
      height: 45,
      alignment: Alignment.center,
      child: Text('$index'),
    );
  },
  separatorBuilder: (BuildContext context, int index){
    return Divider();
  },
  itemCount: 30,
)
```

## | GridView

基本用法：

```dart
GridView(
  scrollDirection: Axis.horizontal, // 同listview
  reverse: true, // // 同listview
  gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(
    crossAxisCount: 3, //横轴三个子 widget
    childAspectRatio: 1.0 //宽高比为 1 时，子 widget
  ),
  children:<Widget>[
    Icon(Icons.ac_unit),
    Icon(Icons.airport_shuttle),
    Icon(Icons.all_inclusive),
    Icon(Icons.beach_access),
    Icon(Icons.cake),
    Icon(Icons.free_breakfast)
  ]
);
```

> gridDelegate 参数控制子控件的排列，有 2 个选择：

- SliverGridDelegateWithFixedCrossAxisCount：交叉轴方向上固定数量，对于垂直方向的 GridView 来说交叉轴方向指的是水平方向。
- SliverGridDelegateWithMaxCrossAxisExtent：交叉轴方向上尽量大，比如水平方上有 500 空间，指定此值为 150，那么可以放 3 个，剩余一些空间，此时 GridView 将会缩小每一个 Item，放置 4 个。

> SliverGridDelegateWithFixedCrossAxisCount 有属性介绍如下：

- crossAxisCount：交叉轴方向上个数。
- mainAxisSpacing：主轴方向上 2 行之间的间隔。
- crossAxisSpacing：交叉轴方向上之间的间隔。
- childAspectRatio：子控件宽高比。

> controller 和 physics 属性用法同 ListView 中一样

**_GridView 提供了一些快速构建的方法_**

1. GridView.builder

```dart
GridView.builder(
  gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(
    crossAxisCount: 3,
  ),
  // 构建子控件
  itemBuilder: (context, index) {
    return Container(
      height: 80,
      color: Colors.primaries[index % Colors.primaries.length],
    );
  },
  itemCount: 50, // 指定数据个数
)
```

2. GridView.custom

```dart
GridView.custom(
  gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(
    crossAxisCount: 3,
  ),
  childrenDelegate: SliverChildBuilderDelegate((context, index) {
    return Container(
        height: 80,
        color: Colors.primaries[index % Colors.primaries.length]);
  }, childCount: 50),
)
```

3. GridView.count

```dart
body: new GridView.count(
  crossAxisCount: 4, // 交叉轴方向上个数
  childAspectRatio: 0.7, // 子控件宽高比。
  mainAxisSpacing: 5, // 主轴方向上2行之间的间隔。
  crossAxisSpacing: 36, // 交叉轴方向上之间的间隔。
  children: List.generate(100, (index){
    return new Center(
      child: new Text(
        'Item ${index}',
        style: Theme.of(context).textTheme.headline,
      ),
    );
  })
)
```

4. GridView.extent

```dart
GridView.extent(
  maxCrossAxisExtent: 100,
  children: List.generate(50, (i) {
    return Container(
      height: 80,
      color: Colors.primaries[i % Colors.primaries.length],
    );
  }),
)
```
